/* Iniciar sesión (Login)*/
use mercado_free;
SELECT * FROM usuarios 
WHERE email = 'user@example.com' AND contrasena = 'hashed_password';

/* REGISTRAR NUEVO USUARIO */
INSERT INTO usuarios (
    id_usuarios, nombre, contrasena, direccion, telefono, fecha_registro, email, estado, codigo_pais_fk
) VALUES (
    UUID(), 'Nombre del Usuario', 'hashed_password', 'Dirección del Usuario', '123456789', CURRENT_TIMESTAMP, 'usuario@correo.com', 0, 1
);

/* Búsqueda de productos */ 

    /* Por categoria */
SELECT p.* FROM productos p
JOIN categorias_productos cp ON p.id_productos = cp.id_productos_fk
WHERE cp.id_categoria_fk = 1;

    /* Por palabra clave */
SELECT * FROM productos 
WHERE nombre LIKE '%keyword%' OR descripcion LIKE '%keyword%';

    /* Por características específicas (ejemplo por fabricante) */
SELECT * FROM productos 
WHERE fabricante = 'Nombre del Fabricante';

/* Lista de productos con detalles */
SELECT p.*, AVG(c.puntuacion) AS rating FROM productos p
LEFT JOIN calificaciones c ON p.id_productos = c.id_producto_fk
GROUP BY p.id_productos;


    /* Agregar producto al carrito */
INSERT INTO carrito (producto_fk , usuario_fk)
VALUES ("id_producto", 'uuid_del_usuario');

	/* Ingresar pedido de una compra */
insert into pedidos (id_usuario_fk,producto_fk,metodo_pago,estado) values ("uuid usuario","id_producto","metodo_de_pago","estado");
	/* mostrar historial usuario */
select u.nombre, p2.nombre,p2.descripcion,p.cantidad,p.estado,p.fecha_pedido 
FROM usuarios u 
Join pedidos p 
	on p.id_usuario_fk = u.id_usuarios 
join productos p2 
	on	p.producto_fk = p2.id_productos
where u.id_usuarios ="a2bdf2d6-4a11-4dd1-91ec-bc0beecbb55c"
order by fecha_pedido 

/* Administrador: CRUD de productos */
INSERT INTO productos (nombre, descripcion, precio, fabricante, stock, fecha_creacion)
VALUES ('Nombre del Producto', 'Descripción del Producto', 100, 'Fabricante del Producto', 50, CURRENT_TIMESTAMP);

    /* Editar un producto */
UPDATE productos 
SET nombre = 'Nuevo Nombre', descripcion = 'Nueva Descripción', precio = 200, fabricante = 'Nuevo Fabricante', stock = 100
WHERE id_productos = 1;

    /* Borrar un producto */
DELETE FROM productos 
WHERE id_productos = 1;

/* Administrador: Gestión de cuentas de usuario */

    /* Aprobar usuario */
UPDATE usuarios 
SET estado = 1 
WHERE id_usuarios = 'uuid_del_usuario';

    /* Reestablecer contraseña */
UPDATE usuarios 
SET contrasena = 'nueva_contraseña_hash'
WHERE email = 'usuario@correo.com';

    /* Gestionar permisos */
UPDATE usuarios 
SET estado = 1 
WHERE id_usuarios = 'uuid_del_usuario';

/* Ver informes de ventas, métricas de rendimiento e inventario */

    /* Informes de ventas */
SELECT u.nombre, pe.estado , pe.fecha_pedido 
FROM pedidos pe
JOIN productos p ON p.id_productos = pe.producto_fk
JOIN usuarios u ON pe.id_usuario_fk = u.id_usuarios 
GROUP BY id_usuario_fk ;

select * from pedidos p;
    /* Métricas de rendimiento */
SELECT estado, COUNT(*) AS cantidad
FROM pedidos
GROUP BY estado;

    /* Datos de inventario */
SELECT nombre, stock 
FROM productos;

/* Dejar comentarios y puntuaciones en productos */
INSERT INTO calificaciones (puntuacion, id_producto_fk, id_usuario_fk)
VALUES (5, 1, 'uuid_del_usuario');

INSERT INTO comentarios (texto, fecha_creacion_comentario, id_producto_fk, id_usuario_fk)
VALUES ('Excelente producto', CURRENT_TIMESTAMP, 1, 'uuid_del_usuario');

/* Mostrar carritos de un usuario */

SELECT u.nombre, p.nombre AS producto, SUM(p.precio * c.cantidad) AS total
FROM carrito c
JOIN usuarios u ON u.id_usuarios = c.usuario_fk
JOIN productos p ON c.producto_fk = p.id_productos
WHERE u.id_usuarios = 'uuid usuario'
GROUP BY u.nombre, p.nombre;

insert carrito(usuario_fk, producto_fk, cantidad) values ("197c131f-e77a-4884-9c3b-ee0216b4e7b2",9,8);